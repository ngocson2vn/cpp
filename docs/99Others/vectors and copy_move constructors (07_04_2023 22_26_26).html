<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en style><!--
 Page saved with SingleFile 
 url: http://www-h.eng.cam.ac.uk/help/tpl/languages/C++/morevectormemory.html 
 saved date: Fri Apr 07 2023 22:26:26 GMT+0800 (Singapore Standard Time)
--><meta charset=utf-8>
<title>CUED - C++ vectors and copy/move constructors</title>
<meta name=description content>
<meta name=keywords content>
<style>html,body,div,span,h1,h2,h4,p,pre,a,code,img,ul,li,fieldset,form,label{margin:0;padding:0;border:0;outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline}:focus{outline:0}ul{list-style:none}h1{padding-top:0.7em}h2{padding-top:0.9em}div#dept-title h1{margin:0;padding:0.2em 0;line-height:normal;font-family:verdana,arial,helvetica,sans serif;font-size:1.4em;font-weight:normal;color:#000;background:#9c9}div#dept-title h1 a{color:#000;text-decoration:none}div#dept-title h2{margin:0;padding:0 0 0.5em 0;line-height:normal;font-family:verdana,arial,helvetica,sans serif;font-size:1.1em;font-weight:normal;color:#000}p code{font-size:1em;color:green}img{display:block}#branding img{float:left}body{font-family:Verdana,Arial,Helvetica,sans-serif;font-size:100%;color:#333;line-height:1.125em}p,ul,pre{font-size:0.75em}h1,h2,h4{line-height:1.25em;margin-bottom:0.5em;font-family:Arial,Helvetica,sans-serif}h1{font-size:1.5em;font-weight:normal}h4{font-size:0.75em;font-weight:bold}p{margin:0 0 1em 0}a:link,a:focus,a:active{color:#003c79;text-decoration:underline}a:visited{color:#003c79}a:hover{text-decoration:underline;color:#003366}ul{list-style-type:square;margin:0 0 1em 2em}pre{background:#f8f4e9;border:1px solid #ddd;padding:1em;margin:0 0 1em 0;font-family:Monaco,monospace;overflow:auto;max-width:95%;min-height:3em}code{font-family:Monaco,monospace}div#site-search form{font-size:0.75em;margin:0 20px 0 9px}div#site-search form label{color:#999999}div#site-search form #search-term{font-family:Arial,Helvetica,sans-serif;font-size:1em;border:1px solid #CCC;padding:2px;width:10em}div#site-search form #search-button{position:relative;top:6px}body{background:#699;padding:0 20px 0 20px}img.ucam{padding:0.7em 1em 0 1em}.dept div#header{border-bottom:1px solid #9c9}div#branding{float:left}div#content{float:left;width:100%;padding-bottom:1em}.dept div#content-primary{margin:1em 0 0 0}.dept div#content-primary h1{margin:0 0 0.5em 0;padding:0}div#content-primary a{text-decoration:none}div#content-primary a:hover{text-decoration:underline}body.one-col div#content-primary{width:100%}.dept div#site-search{padding:0.5em 0 0 0}div#site-search ul{padding:5px;margin:0;list-style-type:none}div#site-search ul li{float:right;padding:0 7px 0 7px}div#site-search ul li.last{background:none;padding-right:15px}div#site-search ul li a{color:#036;text-decoration:none}div#site-search ul li a:hover{color:#c60}div#site-search{float:none;width:auto;height:auto;font-family:Arial,Helvetica,sans-serif}div#site-search form{text-align:right}ul#nav-breadcrumb{overflow:hidden;margin:0;padding:0.5em 0 1em 0;list-style-type:none;color:#666;font-size:0.65em;width:100%}ul#nav-breadcrumb li{float:left;padding:0 6px 0 6px;background:url(data:image/gif;base64,R0lGODlhAwAFAIABAGZmZv///yH5BAEAAAEALAAAAAADAAUAAAIFRG4YlgUAOw==)no-repeat 0 50%}ul#nav-breadcrumb li.first{padding-left:21px;background:url(data:image/gif;base64,R0lGODlhEAAQAMQbANfQxtjRx9bOxdjSyNXNxNnUydvXzNrVytrWy9TLw9LIwNPKwtPJwfHv69LHwN/Y0+/t6e3p5ubj2+Ha1e7q5+DZ0+Da1O/s6PDu6fDu6vDv6v///wAAAAAAAAAAAAAAACH5BAEAABsALAAAAAAQABAAAAVu4CaOW9OQqGRIpWGcqOi+8xtvSK7rWnz8wGAGVSgajwXMCDJoOp9NyAYSqFqvV8gFwO16vReRYEwuj0mEtHqdJiXeiQmFMoEnSIv8wiKy6BckDIIMFSIVgwwkCosKDyIPjAokEQ6VjhsPlQ4RIiEAOw==)no-repeat 0 0}ul#nav-breadcrumb a,ul#nav-breadcrumb a:hover{text-decoration:none}ul#site-info{overflow:hidden;margin:0;clear:both;width:100%;list-style-type:none;border-top:2px solid #9c9;padding-top:1em;padding-bottom:2em;font-size:0.7em}ul#site-info li{float:left}ul#site-info li a{text-decoration:none}div#container{background:#fff;min-width:694px;max-width:900px;margin:0 auto;overflow:hidden;padding:0 20px 0 20px;border-left:1px solid #d3d3b1;border-right:1px solid #d3d3b1;border-bottom:1px solid #d3d3b1}div#dept-title{background:#9c9;min-width:694px;max-width:900px;margin:0 auto;overflow:hidden;padding:0 20px 0 20px;border-left:1px solid #d3d3b1;border-right:1px solid #d3d3b1;border-bottom:1px solid #d3d3b1}div#header{height:70px;margin:0 auto;overflow:hidden;padding:0;background:#fff;min-width:734px;max-width:940px;border-left:1px solid #d3d3b1;border-right:1px solid #d3d3b1}div#content-primary{float:left;padding-right:1em}</style>
<!--[if IE 6]><link rel="stylesheet" href="global/style/ie6.css" type="text/css" media="screen" /><script type="text/javascript" src="global/js/minmax.js"></script><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="global/style/ie7.css" type="text/css" media="screen" /><![endif]-->
<link rel="Shortcut Icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAObl5P+tra//raqo/62rqP+np6j/3t7e/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7u3s/6Wptv9abLv/hZnd////////////mKnf/1dqvP+epLX/6ejn/wAAAAAAAAAAAAAAAAAAAAAAAAAA0M7N/3aFuP86RNf/Kxzu/32S6v///////////5Kl6P8sG+3/Nz/a/21+t//Ix8X/AAAAAAAAAAAAAAAA29rZ/2V1s/8wJ+f/NzPv/zQt7v9rfMv///////////97isf/NjLu/zc17/8vIur/W2y0/87My/8AAAAAAAAAAI+ZtP8yMd3/FsD+/xbB//8yKO7/gZbr////////////mKvt/zMs7v8Wwf//FsD+/zAp4/+Dj7T/AAAAAAAAAABnecX/MSXu/xbB//8Wwf//Myvu/3KE1f///////////4OT0f80Me7/FsH//xbB//8yKO7/VWa1/wAAAAAAAAAATV62/y0c7v8yKe7/Mynu/y0c7v9xhNn///////////+Jm9z/Lhzu/zIp7f8zKe7/Lhzu/0JSwf8AAAAAAAAAAG99r/9uhfT/c4r1/3SM9v9wiPX/g5XT/5amyf+Vpcz/hZfT/3GK9f9zi/X/c4v1/3CH9f9yhMj/AAAAAAAAAACamJb//////////////////////3SIrP8WwP7/F8H//2F+yP//////////////////////o6Kh/wAAAAAAAAAAnZuZ//////////////////////93iq//FsH//xbA/v9hfsf//////////////////////6elpP8AAAAAAAAAAHB9r/9uhPT/dYv1/3WL9v9yiPX/gpHO/46dwv+Qn8X/hJTQ/3OJ9f91i/X/dYv2/3GH9f9zhMj/AAAAAAAAAABIWKv/LRzu/zMq7v8yKe3/LRvt/2t8zv///////////3+OzP8uG+3/Mint/zIp7v8uHO3/QlHC/wAAAAAAAAAATV2s/zMr7v8Xwf//FsH//zMo7v98kOP///////////+UpeX/NC3u/xbB//8Wwf//NS7u/0hYwv8AAAAAAAAAAE1drP8zK+7/FsH//xbB//8yKe3/d4nb////////////h5fW/zQv7v8Wwf//F8H//zUu7v9IWML/AAAAAAAAAABJWav/LRvt/zMr7v8zK+7/Lhzt/2x+0v///////////4GS1P8uG+3/Myvu/zMr7v8uG+3/Q1LD/wAAAAAAAAAASFF4/0xcsv9NXaz/TVyr/0hXq/96hq7/oZ2Z/6Gemv+Ika//SFir/01crP9NXaz/TFyx/1Bckf8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//w=="><style>.sf-hidden{display:none!important}</style><link rel=canonical href=http://www-h.eng.cam.ac.uk/help/tpl/languages/C++/morevectormemory.html><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class="one-col dept">
<div id=skip class=sf-hidden> &nbsp;|&nbsp; </div><div id=header>
 <div id=branding><a href=http://www.cam.ac.uk/ accesskey=1><img src="data:image/gif;base64,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" alt="University of Cambridge" class=ucam></a>
 </div>
 <div id=site-search>
 <form action=http://search.cam.ac.uk/web>
 <fieldset>
 <label for=search-term>Search</label>
 <input name=query type=text id=search-term accesskey=4 value>
 
 <input id=search-button src="data:image/gif;base64,R0lGODlhFgAWALMPAJmZmfLy8qampr+/v5+fn8zMzLOzs9/f3+zs7NnZ2aysrPn5+eXl5dLS0rm5uf///yH5BAEAAA8ALAAAAAAWABYAAASS8MnJhgAYiIGmn4GRjZkRfNJBkCxAHN/RzgAsBWu2Fc5MnA9RpuAJKFqGB2JELKwEjMWFhRjoHoXRT8ayZAaP3PDRmmKILDQN43gcR43AOhNgiBWL5RyADxQKDQsSCWUkAjYBHYOGVmsJE4Rfeo4TjQAdQpRBGEkPOHsDQj8TXHsYNqRiNC8onplIQK1KXjocKBEAOw==" value=Search alt=Search title=Search type=image>
 </fieldset>
 </form>
 <ul>
 
 <li class=last><a href=http://www.eng.cam.ac.uk/people/>Contact us</a></li>
 </ul>
 </div>
</div>
<div id=dept-title>
 <h1><a href=http://www.eng.cam.ac.uk/>Department of Engineering</a></h1>
 <h2>IT Services</h2>
</div>
<div id=container> <a name=skip-content id=skip-content></a>
 <ul id=nav-breadcrumb>
 <li class=first><a href=http://www.cam.ac.uk/>University of Cambridge</a></li>
 <li><a href=http://www.eng.cam.ac.uk/>Department&nbsp;of&nbsp;Engineering</a></li>
 <li><a href=http://www-h.eng.cam.ac.uk/help/ class=bread>Computing Help</a></li>
 <li>C++</li>
 </ul>
 <h4 id=title-nav-primary></h4>
 <ul id=nav-primary class=sf-hidden>
 
 
 
 
 
 </ul>
 <div id=content>
 <div id=content-primary>
<h1>C++ vectors and copy/move constructors</h1>
<p><i>These examples require C++11 or newer and illustrate some issues with move constructors. They use some
features discussed in <a href=http://www-h.eng.cam.ac.uk/help/tpl/languages/C++/vectormemory.html>C++ vector memory and 2D vectors</a>.</i></p>
<p>In programs, temporary, intermediate variables are often created. For examples, in </p>
<pre>  x=3*(a+b)
</pre>
<p>a variable is created to store the result of <code>a+b</code> then another variable is created to store the
value of the expression on the right-hand side (RHS). This variable's value is copied into <code>x</code> then the temporary variables are
destroyed. If these variables are big (they may be objects containing images or matrices), creating them may be
expensive. Sometimes (in principle at least) it's possible to avoid copying. For instance, in this example once a variable has been created holding the RHS value, it would be nice if somehow the name <code>x</code> could point to the RHS variable, rather than copying the RHS variable into <code>x</code> then destroying it.</p>
<p>"move constructors" arrived with C++11. They offer programmers the chance to exploit these opportunities to 
speed programs up. This document hopes to show some of the ways that the <code>vector</code> code has been changed
to facilitate such exploitation, but doesn't show how to speed code up. Let's first consider this program. It creates a class with 2 constructors which
for our purposes merely print messages. Then it adds objects to a vector one at and time</p>
<pre>#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

class A
{
public:
  A() {cout &lt;&lt; "A constructor" &lt;&lt; endl;}
  A(const A&amp; rhs) {cout &lt;&lt; "A copy constructor" &lt;&lt; endl;}
};

int main()
{
int main() {
vector &lt;A&gt; v;
cout &lt;&lt; "About to push_back 1st element" &lt;&lt; endl;
v.push_back(A());

cout &lt;&lt; "About to push_back 2nd element" &lt;&lt; endl;
v.push_back(A()); 

cout &lt;&lt; "About to push_back 3rd element" &lt;&lt; endl;
v.push_back(A());

cout &lt;&lt; "About to push_back 4th element" &lt;&lt; endl;
v.push_back(A());
}
</pre>
<p>The output is </p>
<pre>About to push_back 1st element
A constructor
A copy constructor
About to push_back 2nd element
A constructor
A copy constructor
A copy constructor
About to push_back 3rd element
A constructor
A copy constructor
A copy constructor
A copy constructor
About to push_back 4th element
A constructor
A copy constructor
</pre>
<p>which shows how much copying happens in programs. When the first element
is created, the constructor is called. Then an element is created in the 
vector by copying. So far so good. The sequence of events involving the 2nd element may be more of a surprise - why is the copy constructor called twice? If we change the program to produce more output we can see why</p>
<pre>#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

class A
{
public:
  A() {cout &lt;&lt; "A constructor" &lt;&lt; endl;}
  A(const A&amp; rhs) {cout &lt;&lt; "A copy constructor" &lt;&lt; endl;}
};

int main()
{
int main() {
vector &lt;A&gt; v;
cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 1st element" &lt;&lt; endl;
v.push_back(A());

cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 2nd element" &lt;&lt; endl;
v.push_back(A()); 

cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 3rd element" &lt;&lt; endl;
v.push_back(A());

cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 4th element" &lt;&lt; endl;
v.push_back(A());
}
</pre>
<p>Now the output is </p>
<pre>capacity: 0
About to push_back 1st element
A constructor
A copy constructor
capacity: 1
About to push_back 2nd element
A constructor
A copy constructor
A copy constructor
capacity: 2
About to push_back 3rd element
A constructor
A copy constructor
A copy constructor
A copy constructor
capacity: 4
About to push_back 4th element
A constructor
A copy constructor
</pre>
<p>After adding the first element, the vector was full, so when a second element was added, a new, bigger vector (of size 2) was created behind the scenes. The old vector's element was copied into it, then the new element added, both using the copy constructor. Adding a third element forced new vector space to be created, this time of size 4 (the size goes up in powers of 2), so when the fourth element was added there was no need to create a new vector and copy old values over.</p>
<p>Let's see what happens when we add a move constructor.</p>
<pre>#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

class A
{
public:
  A() {cout &lt;&lt; "A constructor" &lt;&lt; endl;}
  A(const A&amp; rhs) {cout &lt;&lt; "A copy constructor" &lt;&lt; endl;}
  A(A&amp;&amp; rhs) {cout &lt;&lt; "A move constructor" &lt;&lt; endl;}
};

int main()
{
int main() {
vector &lt;A&gt; v;
cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 1st element" &lt;&lt; endl;
v.push_back(A());

cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 2nd element" &lt;&lt; endl;
v.push_back(A()); 

cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 3rd element" &lt;&lt; endl;
v.push_back(A());

cout &lt;&lt; "capacity: " &lt;&lt; (int) v.capacity() &lt;&lt;  endl;
cout &lt;&lt; "About to push_back 4th element" &lt;&lt; endl;
v.push_back(A());
}
</pre>
<p>Now the output is</p>
<pre>capacity: 0
About to push_back 1st element
A constructor
A move constructor
capacity: 1
About to push_back 2nd element
A constructor
A move constructor
A copy constructor
capacity: 2
About to push_back 3rd element
A constructor
A move constructor
A copy constructor
A copy constructor
capacity: 4
About to push_back 4th element
A constructor
A move constructor
</pre>
<p>The <code>vector</code> has used the move constructor in preference to the copy constructor, but not always. Judging by the number of calls, it seems that <code>move</code> is used by <code>push_back</code> but not when new vector storage space is created. If we change the 
<pre>  A(A&amp;&amp; rhs) {cout &lt;&lt; "A move constructor" &lt;&lt; endl;}
</pre>
<p>line to</p> 
<pre>  A(A&amp;&amp; rhs) noexcept {cout &lt;&lt; "A move constructor" &lt;&lt; endl;} 
</pre>
<p>(promising that no exceptions will be thrown by our move constructor) all the copies become moves, and speed-ups might be possible. So what's going on?</p>
<p>The <code>vector</code> code tries to use the move constructor if possible in the hope that it will improve efficiency, but the vector routines have tight specifications. In particular, there are circumstances where a move constructor's only used if it doesn't throw exceptions.</p>
<p>To summarise -</p>
<ul>
<li>Note that vectors do quite a lot of copying behind the scenes. You can reduce that by setting the vector to its maximum size immediately</li>
<li>The standard algorithms offer opportunities to exploit move constructors, but it's not a topic for beginners.</li>
</ul>
<p>p.s. I don't know why in the last sample of program output the move constructor seems to be called <i>before</i> the copy constructor.</p>
 </div> 
 </div> 
 <ul id=site-info>
 <li class=copy>© Cambridge University, Engineering Department, Trumpington Street, Cambridge CB2 1PZ, UK (<a href=http://www-h.eng.cam.ac.uk/visitors/>map</a>)<br>
Tel: +44 1223 332600, Fax: +44 1223 332662<br>
<a href=http://www.cam.ac.uk/about-this-site/privacy-policy>Privacy policy</a><br>
 Contact: <a href=http://www.eng.cam.ac.uk/contact_addresses.html>helpdesk</a></li>
 </ul>
</div> 
